---
import AppLayout from '../layouts/AppLayout.astro';
import {Search} from '../components/Search';

const response = await fetch('https://search.sc2.gg/recent?refresh');

let results = {
  replays: {
    query: 'Random from last 3mo',
    value: [],
    state: 'success',
  },
  players: {
    query: 'Popular from last 3mo',
    value: [],
    state: 'success',
  },
  maps: {
    query: 'Popular from last 6mo',
    value: [],
    state: 'success',
  },
  events: {
    query: 'Popular from last 6mo',
    value: [],
    state: 'success',
  },
};

if (response.ok) {
  const resultValues = await response.json();

  results.replays.value = resultValues.replays;
  results.players.value = resultValues.players;
  results.maps.value = resultValues.maps;
  results.events.value = resultValues.events;

  const occurrenceSort = (a, b) => b.occurrences - a.occurrences;

  results.players.value.sort(occurrenceSort);
  results.maps.value.sort(occurrenceSort);
  results.events.value.sort(occurrenceSort);
}
---
<AppLayout>
  <Search initialResults={results} client:load />
</AppLayout>
